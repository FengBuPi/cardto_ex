CardTo Chrome扩展数据流向图
=====================================

用户操作流程:
┌─────────────┐
│   用户点击   │
│ 扩展图标/快捷键 │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ Background  │
│   Script    │
│(background.ts)│
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 获取页面HTML │
│ 检查URL权限  │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ Content     │
│   Script    │
│(content.tsx)│
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 解析为      │
│ Markdown    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 复制到      │
│ 剪贴板      │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 发送消息给   │
│ Background  │
│   Script    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 调用API     │
│ POST请求    │
│ localhost:3000│
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 显示成功    │
│ 提示/动画   │
└─────────────┘

消息传递机制:
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Popup     │    │ Background  │    │ Content     │
│             │    │   Script    │    │   Script    │
└──────┬──────┘    └──────┬──────┘    └──────┬──────┘
       │                  │                  │
       │ COPY_TEXT        │                  │
       ├─────────────────►│                  │
       │                  │                  │
       │                  │ COPY_TEXT        │
       │                  ├─────────────────►│
       │                  │ (HTML内容)       │
       │                  │                  │
       │                  │                  │ UPLOAD_MARKDOWN
       │                  │◄─────────────────┤ (Markdown文本)
       │                  │                  │
       │                  │ API调用          │
       │                  │ POST /api/data   │
       │                  │                  │
       │                  │ 返回结果         │
       │                  ├─────────────────►│
       │                  │                  │

API数据格式:
┌─────────────────────────────────────────┐
│ 请求: POST http://localhost:3000/api/data│
│ Content-Type: application/json          │
│                                         │
│ {                                       │
│   "data": "生成的Markdown文本",          │
│   "description": ""                     │
│ }                                       │
└─────────────────────────────────────────┘

错误处理流程:
┌─────────────┐
│   错误发生   │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 记录错误日志 │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 继续执行    │
│ 核心功能    │
│ (复制功能)   │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 显示用户    │
│ 友好提示    │
└─────────────┘

关键优势:
• 解决CORS问题 - API调用在Background Script中执行
• 异步处理 - 不阻塞用户界面
• 错误容错 - API失败不影响复制功能
• 消息传递 - 组件间解耦通信
• 性能优化 - Service Worker资源占用小
